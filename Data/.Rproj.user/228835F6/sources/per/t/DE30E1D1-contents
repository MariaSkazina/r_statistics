# '/home/maria/Bioinf/r_statistics/test_of_function' моя рабочая директория ----
library(plyr)
library(dplyr)
library(readr)
library(ggplot2)
## СОБИРАЮ ЕДИНЫЙ ФАЙЛ ----


merge_csv <- function(x){
  setwd(x)
  mydir = x
  myfiles = list.files(path = mydir, pattern="*.csv", full.names=TRUE) # делаю список из файлов в директории
  dat_csv <- ldply(myfiles, read_csv) # создали один большой csv по списку файлов в директории
}

dat_csv <- merge_csv('/home/maria/Bioinf/r_statistics/test_of_function')

## КАК СДЕЛАТЬ НОРМ ДАТАФРЕЙМ ----
str(dat_csv)# смотрим наш датафрейм, там следующие проблемы SEX обозначен цифрами
names(dat_csv)[2] <- "Sex" #заменили название на приличное
table(dat_csv$Sex) # кто то неправильно ввел переменные
dat_csv2 <- dat_csv %>% mutate(Sex = replace(Sex, Sex == 'male', '1')) %>% mutate(Sex = replace(Sex, Sex == 'one', '1')) %>% mutate(Sex = replace(Sex, Sex == 'three', '3')) #исправили текстовые значения в графе Sex
levels(dat_csv2$Sex) <- c("male", "female", "juvenile") #присвоили переменным приличные имена
table(dat_csv2$Sex)
dat_csv2$Sex <- as.factor(dat_csv2$Sex) # изменить тип переменной SEX - это фактор
dat_csv2$Rings <- as.numeric(dat_csv2$Rings)
dat_csv2$Length <- as.numeric(dat_csv2$Length)
str(dat_csv2$Sex)

## УБИРАЮ NA - их мало, можно и забить ----
colSums(is.na(dat_csv2)) # сколько данных пропущено в каждой из колонок
sum(is.na(dat_csv2)) # всего 22 штуки
snails <- na.omit(dat_csv2) # удаляю!!!
head(snails) # наслаждаюсь внешним видом данных без NA

# 3. ----
#Рассчитай среднее значение и стандартное отклонение переменной Length для
# моллюсков разного пола.

male_snails <- subset(snails, Sex == 'male')
female_snails <- subset(snails, Sex == 'female')
juvenile_snails <- subset(snails, Sex == 'juvenile')

mean(male_snails$Length)
mean(female_snails$Length)
mean(juvenile_snails$Length)

sd(male_snails$Length)
sd(female_snails$Length)
sd(juvenile_snails$Length)

ggplot(snails, aes(factor(Sex), Length) +
  geom_boxplot()

# 4. У какого процента моллюсков значение переменной Height не превышает 0.165? ----
short_snails <- snails %>% filter(Height <= 0.165) 
rate_of_short_snails <- nrow(short_snails) / nrow(snails) * 100

#5. Чему равняется значение переменной Length, которое выше чем у 92% от всех наблюдений? ----
long_snails

long_snails <- quantile(snails$Length, p = seq(0, 1, 0.92), names = FALSE)
length_long_snails <- long_snails[2] 

# 6. Создай новую переменную Lenght_z_scores и сохрани в нее значения переменной ----
# Length после её стандартизации.
snails <- snails %>% mutate(Lenght_z_scores = scale(snails$Length))

#7. Сравни между собой диаметр моллюсков с числом колец 5 и 15. К каким выводам
#ты пришел? Пожалуйста, оформи результаты так, чтобы мы сразу могли использовать
#их для статьи.
rings5 <- subset(snails, Rings == 5)
rings15 <- subset(snails, Rings == 15)

mean(rings5$Diameter) 
mean(rings15$Diameter)

sd(rings5$Diameter) 
sd(rings15$Diameter)

ggplot

#8. Нас особенно интересуют переменные Diametr и Whole_weight. Что ты можешь про
#них сказать? Есть ли у нас основания предполагать, что они могут быть
#взаимосвязаны? Как ты это определил?
